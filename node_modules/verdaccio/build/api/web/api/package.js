"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _lodash = _interopRequireDefault(require("lodash"));
var _middleware = require("@verdaccio/middleware");
var _tarball = require("@verdaccio/tarball");
var _utils = require("@verdaccio/utils");
var _constants = require("../../../lib/constants");
var _logger = require("../../../lib/logger");
var _utils2 = require("../../../lib/utils");
function _interopRequireDefault(e) { return e && e.__esModule ? e : { default: e }; }
function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }
function _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == typeof i ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != typeof i) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
const getOrder = (order = 'asc') => {
  return order === 'asc';
};
function addPackageWebApi(pkgRouter, storage, auth, config) {
  const can = (0, _middleware.allow)(auth, {
    beforeAll: (params, message) => {
      _logger.logger.debug(params, message);
    },
    afterAll: (params, message) => _logger.logger.debug(params, message)
  });
  const checkAllow = (name, remoteUser) => new Promise((resolve, reject) => {
    try {
      auth.allow_access({
        packageName: name
      }, remoteUser, (err, allowed) => {
        if (err) {
          resolve(false);
        }
        resolve(allowed);
      });
    } catch (err) {
      reject(err);
    }
  });

  // Get list of all visible package
  pkgRouter.get('/-/verdaccio/data/packages', function (req, res, next) {
    storage.getLocalDatabase(async function (err, packages) {
      if (err) {
        throw err;
      }
      async function processPackages(packages = []) {
        const permissions = [];
        const packgesCopy = packages.slice();
        for (const pkg of packgesCopy) {
          const pkgCopy = _objectSpread({}, pkg);
          pkgCopy.author = (0, _utils2.formatAuthor)(pkg.author);
          try {
            const isAllowed = await checkAllow(pkg.name, req.remote_user);
            if (isAllowed) {
              if (config.web) {
                pkgCopy.author.avatar = (0, _utils.generateGravatarUrl)(pkgCopy.author.email, config.web.gravatar);
              }
              if (!_lodash.default.isNil(pkgCopy.dist) && !_lodash.default.isNull(pkgCopy.dist.tarball)) {
                pkgCopy.dist.tarball = (0, _tarball.getLocalRegistryTarballUri)(pkgCopy.dist.tarball, pkg.name, {
                  protocol: req.protocol,
                  headers: req.headers,
                  host: req.hostname
                }, config.url_prefix);
              }
              permissions.push(pkgCopy);
            }
          } catch (err) {
            _logger.logger.error({
              name: pkg.name,
              error: err
            }, 'permission process for @{name} has failed: @{error}');
            throw err;
          }
        }
        return permissions;
      }
      const {
        web
      } = config;
      // @ts-ignore
      const order = config.web ? getOrder(web.sort_packages) : true;
      try {
        next((0, _utils2.sortByName)(await processPackages(packages), order));
      } catch (error) {
        next(_utils2.ErrorCode.getInternalError());
      }
    });
  });

  // Get package readme
  pkgRouter.get(['/-/verdaccio/data/package/readme/@:scope/:package/:version?', '/-/verdaccio/data/package/readme/:package/:version?'], can('access'), function (req, res, next) {
    const scope = req.params.scope;
    const packageName = scope ? (0, _utils2.addScope)(scope, req.params.package) : req.params.package;
    storage.getPackage({
      name: packageName,
      uplinksLook: true,
      req,
      callback: function (err, info) {
        if (err) {
          return next(err);
        }
        res.set(_constants.HEADER_TYPE.CONTENT_TYPE, _constants.HEADERS.TEXT_PLAIN);
        next((0, _utils2.parseReadme)(info.name, info.readme));
      }
    });
  });
  pkgRouter.get(['/-/verdaccio/data/sidebar/@:scope/:package', '/-/verdaccio/data/sidebar/:package'], can('access'), function (req, res, next) {
    const scope = req.params.scope;
    const packageName = scope ? (0, _utils2.addScope)(scope, req.params.package) : req.params.package;
    storage.getPackage({
      name: packageName,
      uplinksLook: true,
      keepUpLinkData: true,
      req,
      callback: function (err, info) {
        if (_lodash.default.isNil(err)) {
          const {
            v
          } = req.query;
          let sideBarInfo = _lodash.default.clone(info);
          sideBarInfo.versions = (0, _tarball.convertDistRemoteToLocalTarballUrls)(info, {
            protocol: req.protocol,
            headers: req.headers,
            host: req.hostname
          }, config.url_prefix).versions;
          if ((0, _utils2.isVersionValid)(info, v)) {
            // @ts-ignore
            sideBarInfo.latest = sideBarInfo.versions[v];
            sideBarInfo.latest.author = (0, _utils2.formatAuthor)(sideBarInfo.latest.author);
          } else {
            var _sideBarInfo;
            sideBarInfo.latest = sideBarInfo.versions[info[_constants.DIST_TAGS].latest];
            if ((_sideBarInfo = sideBarInfo) !== null && _sideBarInfo !== void 0 && _sideBarInfo.latest) {
              sideBarInfo.latest.author = (0, _utils2.formatAuthor)(sideBarInfo.latest.author);
            } else {
              res.status(_constants.HTTP_STATUS.NOT_FOUND);
              res.end();
              return;
            }
          }
          sideBarInfo = (0, _utils2.deleteProperties)(['readme', '_attachments', '_rev', 'name'], sideBarInfo);
          if (config.web) {
            sideBarInfo = (0, _utils2.addGravatarSupport)(sideBarInfo, config.web.gravatar);
          } else {
            sideBarInfo = (0, _utils2.addGravatarSupport)(sideBarInfo);
          }
          next(sideBarInfo);
        } else {
          res.status(_constants.HTTP_STATUS.NOT_FOUND);
          res.end();
        }
      }
    });
  });
  return pkgRouter;
}
var _default = exports.default = addPackageWebApi;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbG9kYXNoIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfbWlkZGxld2FyZSIsIl90YXJiYWxsIiwiX3V0aWxzIiwiX2NvbnN0YW50cyIsIl9sb2dnZXIiLCJfdXRpbHMyIiwiZSIsIl9fZXNNb2R1bGUiLCJkZWZhdWx0Iiwib3duS2V5cyIsInIiLCJ0IiwiT2JqZWN0Iiwia2V5cyIsImdldE93blByb3BlcnR5U3ltYm9scyIsIm8iLCJmaWx0ZXIiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJlbnVtZXJhYmxlIiwicHVzaCIsImFwcGx5IiwiX29iamVjdFNwcmVhZCIsImFyZ3VtZW50cyIsImxlbmd0aCIsImZvckVhY2giLCJfZGVmaW5lUHJvcGVydHkiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzIiwiZGVmaW5lUHJvcGVydGllcyIsImRlZmluZVByb3BlcnR5IiwiX3RvUHJvcGVydHlLZXkiLCJ2YWx1ZSIsImNvbmZpZ3VyYWJsZSIsIndyaXRhYmxlIiwiaSIsIl90b1ByaW1pdGl2ZSIsIlN5bWJvbCIsInRvUHJpbWl0aXZlIiwiY2FsbCIsIlR5cGVFcnJvciIsIlN0cmluZyIsIk51bWJlciIsImdldE9yZGVyIiwib3JkZXIiLCJhZGRQYWNrYWdlV2ViQXBpIiwicGtnUm91dGVyIiwic3RvcmFnZSIsImF1dGgiLCJjb25maWciLCJjYW4iLCJhbGxvdyIsImJlZm9yZUFsbCIsInBhcmFtcyIsIm1lc3NhZ2UiLCJsb2dnZXIiLCJkZWJ1ZyIsImFmdGVyQWxsIiwiY2hlY2tBbGxvdyIsIm5hbWUiLCJyZW1vdGVVc2VyIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJhbGxvd19hY2Nlc3MiLCJwYWNrYWdlTmFtZSIsImVyciIsImFsbG93ZWQiLCJnZXQiLCJyZXEiLCJyZXMiLCJuZXh0IiwiZ2V0TG9jYWxEYXRhYmFzZSIsInBhY2thZ2VzIiwicHJvY2Vzc1BhY2thZ2VzIiwicGVybWlzc2lvbnMiLCJwYWNrZ2VzQ29weSIsInNsaWNlIiwicGtnIiwicGtnQ29weSIsImF1dGhvciIsImZvcm1hdEF1dGhvciIsImlzQWxsb3dlZCIsInJlbW90ZV91c2VyIiwid2ViIiwiYXZhdGFyIiwiZ2VuZXJhdGVHcmF2YXRhclVybCIsImVtYWlsIiwiZ3JhdmF0YXIiLCJfIiwiaXNOaWwiLCJkaXN0IiwiaXNOdWxsIiwidGFyYmFsbCIsImdldExvY2FsUmVnaXN0cnlUYXJiYWxsVXJpIiwicHJvdG9jb2wiLCJoZWFkZXJzIiwiaG9zdCIsImhvc3RuYW1lIiwidXJsX3ByZWZpeCIsImVycm9yIiwic29ydF9wYWNrYWdlcyIsInNvcnRCeU5hbWUiLCJFcnJvckNvZGUiLCJnZXRJbnRlcm5hbEVycm9yIiwic2NvcGUiLCJhZGRTY29wZSIsInBhY2thZ2UiLCJnZXRQYWNrYWdlIiwidXBsaW5rc0xvb2siLCJjYWxsYmFjayIsImluZm8iLCJzZXQiLCJIRUFERVJfVFlQRSIsIkNPTlRFTlRfVFlQRSIsIkhFQURFUlMiLCJURVhUX1BMQUlOIiwicGFyc2VSZWFkbWUiLCJyZWFkbWUiLCJrZWVwVXBMaW5rRGF0YSIsInYiLCJxdWVyeSIsInNpZGVCYXJJbmZvIiwiY2xvbmUiLCJ2ZXJzaW9ucyIsImNvbnZlcnREaXN0UmVtb3RlVG9Mb2NhbFRhcmJhbGxVcmxzIiwiaXNWZXJzaW9uVmFsaWQiLCJsYXRlc3QiLCJfc2lkZUJhckluZm8iLCJESVNUX1RBR1MiLCJzdGF0dXMiLCJIVFRQX1NUQVRVUyIsIk5PVF9GT1VORCIsImVuZCIsImRlbGV0ZVByb3BlcnRpZXMiLCJhZGRHcmF2YXRhclN1cHBvcnQiLCJfZGVmYXVsdCIsImV4cG9ydHMiXSwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvYXBpL3dlYi9hcGkvcGFja2FnZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBSb3V0ZXIgfSBmcm9tICdleHByZXNzJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5cbmltcG9ydCB7IGFsbG93IH0gZnJvbSAnQHZlcmRhY2Npby9taWRkbGV3YXJlJztcbmltcG9ydCB7XG4gIGNvbnZlcnREaXN0UmVtb3RlVG9Mb2NhbFRhcmJhbGxVcmxzLFxuICBnZXRMb2NhbFJlZ2lzdHJ5VGFyYmFsbFVyaSxcbn0gZnJvbSAnQHZlcmRhY2Npby90YXJiYWxsJztcbmltcG9ydCB7IENvbmZpZywgTWFuaWZlc3QgfSBmcm9tICdAdmVyZGFjY2lvL3R5cGVzJztcbmltcG9ydCB7IGdlbmVyYXRlR3JhdmF0YXJVcmwgfSBmcm9tICdAdmVyZGFjY2lvL3V0aWxzJztcblxuaW1wb3J0IEF1dGggZnJvbSAnLi4vLi4vLi4vbGliL2F1dGgnO1xuaW1wb3J0IHsgRElTVF9UQUdTLCBIRUFERVJTLCBIRUFERVJfVFlQRSwgSFRUUF9TVEFUVVMgfSBmcm9tICcuLi8uLi8uLi9saWIvY29uc3RhbnRzJztcbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gJy4uLy4uLy4uL2xpYi9sb2dnZXInO1xuaW1wb3J0IFN0b3JhZ2UgZnJvbSAnLi4vLi4vLi4vbGliL3N0b3JhZ2UnO1xuaW1wb3J0IHtcbiAgRXJyb3JDb2RlLFxuICBhZGRHcmF2YXRhclN1cHBvcnQsXG4gIGFkZFNjb3BlLFxuICBkZWxldGVQcm9wZXJ0aWVzLFxuICBmb3JtYXRBdXRob3IsXG4gIGlzVmVyc2lvblZhbGlkLFxuICBwYXJzZVJlYWRtZSxcbiAgc29ydEJ5TmFtZSxcbn0gZnJvbSAnLi4vLi4vLi4vbGliL3V0aWxzJztcbmltcG9ydCB7ICROZXh0RnVuY3Rpb25WZXIsICRSZXF1ZXN0RXh0ZW5kLCAkUmVzcG9uc2VFeHRlbmQsICRTaWRlYmFyUGFja2FnZSB9IGZyb20gJy4uLy4uLy4uL3R5cGVzJztcblxuY29uc3QgZ2V0T3JkZXIgPSAob3JkZXIgPSAnYXNjJykgPT4ge1xuICByZXR1cm4gb3JkZXIgPT09ICdhc2MnO1xufTtcblxuZXhwb3J0IHR5cGUgUGFja2NhZ2VFeHQgPSBNYW5pZmVzdCAmIHsgYXV0aG9yOiBhbnk7IGRpc3Q/OiB7IHRhcmJhbGw6IHN0cmluZyB9IH07XG5cbmZ1bmN0aW9uIGFkZFBhY2thZ2VXZWJBcGkocGtnUm91dGVyOiBSb3V0ZXIsIHN0b3JhZ2U6IFN0b3JhZ2UsIGF1dGg6IEF1dGgsIGNvbmZpZzogQ29uZmlnKTogUm91dGVyIHtcbiAgY29uc3QgY2FuID0gYWxsb3coYXV0aCwge1xuICAgIGJlZm9yZUFsbDogKHBhcmFtcywgbWVzc2FnZSkgPT4ge1xuICAgICAgbG9nZ2VyLmRlYnVnKHBhcmFtcywgbWVzc2FnZSk7XG4gICAgfSxcbiAgICBhZnRlckFsbDogKHBhcmFtcywgbWVzc2FnZSkgPT4gbG9nZ2VyLmRlYnVnKHBhcmFtcywgbWVzc2FnZSksXG4gIH0pO1xuXG4gIGNvbnN0IGNoZWNrQWxsb3cgPSAobmFtZSwgcmVtb3RlVXNlcik6IFByb21pc2U8Ym9vbGVhbj4gPT5cbiAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KTogdm9pZCA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBhdXRoLmFsbG93X2FjY2Vzcyh7IHBhY2thZ2VOYW1lOiBuYW1lIH0sIHJlbW90ZVVzZXIsIChlcnIsIGFsbG93ZWQpOiB2b2lkID0+IHtcbiAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICByZXNvbHZlKGZhbHNlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmVzb2x2ZShhbGxvd2VkKTtcbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgLy8gR2V0IGxpc3Qgb2YgYWxsIHZpc2libGUgcGFja2FnZVxuICBwa2dSb3V0ZXIuZ2V0KFxuICAgICcvLS92ZXJkYWNjaW8vZGF0YS9wYWNrYWdlcycsXG4gICAgZnVuY3Rpb24gKHJlcTogJFJlcXVlc3RFeHRlbmQsIHJlczogJFJlc3BvbnNlRXh0ZW5kLCBuZXh0OiAkTmV4dEZ1bmN0aW9uVmVyKTogdm9pZCB7XG4gICAgICBzdG9yYWdlLmdldExvY2FsRGF0YWJhc2UoYXN5bmMgZnVuY3Rpb24gKGVyciwgcGFja2FnZXMpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgfVxuXG4gICAgICAgIGFzeW5jIGZ1bmN0aW9uIHByb2Nlc3NQYWNrYWdlcyhwYWNrYWdlczogUGFja2NhZ2VFeHRbXSA9IFtdKTogUHJvbWlzZTxhbnk+IHtcbiAgICAgICAgICBjb25zdCBwZXJtaXNzaW9uczogUGFja2NhZ2VFeHRbXSA9IFtdO1xuICAgICAgICAgIGNvbnN0IHBhY2tnZXNDb3B5ID0gcGFja2FnZXMuc2xpY2UoKTtcbiAgICAgICAgICBmb3IgKGNvbnN0IHBrZyBvZiBwYWNrZ2VzQ29weSkge1xuICAgICAgICAgICAgY29uc3QgcGtnQ29weSA9IHsgLi4ucGtnIH07XG4gICAgICAgICAgICBwa2dDb3B5LmF1dGhvciA9IGZvcm1hdEF1dGhvcihwa2cuYXV0aG9yKTtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIGNvbnN0IGlzQWxsb3dlZCA9IGF3YWl0IGNoZWNrQWxsb3cocGtnLm5hbWUsIHJlcS5yZW1vdGVfdXNlcik7XG4gICAgICAgICAgICAgIGlmIChpc0FsbG93ZWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoY29uZmlnLndlYikge1xuICAgICAgICAgICAgICAgICAgcGtnQ29weS5hdXRob3IuYXZhdGFyID0gZ2VuZXJhdGVHcmF2YXRhclVybChcbiAgICAgICAgICAgICAgICAgICAgcGtnQ29weS5hdXRob3IuZW1haWwsXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZy53ZWIuZ3JhdmF0YXJcbiAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICghXy5pc05pbChwa2dDb3B5LmRpc3QpICYmICFfLmlzTnVsbChwa2dDb3B5LmRpc3QudGFyYmFsbCkpIHtcbiAgICAgICAgICAgICAgICAgIHBrZ0NvcHkuZGlzdC50YXJiYWxsID0gZ2V0TG9jYWxSZWdpc3RyeVRhcmJhbGxVcmkoXG4gICAgICAgICAgICAgICAgICAgIHBrZ0NvcHkuZGlzdC50YXJiYWxsLFxuICAgICAgICAgICAgICAgICAgICBwa2cubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgeyBwcm90b2NvbDogcmVxLnByb3RvY29sLCBoZWFkZXJzOiByZXEuaGVhZGVycyBhcyBhbnksIGhvc3Q6IHJlcS5ob3N0bmFtZSB9LFxuICAgICAgICAgICAgICAgICAgICBjb25maWcudXJsX3ByZWZpeFxuICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcGVybWlzc2lvbnMucHVzaChwa2dDb3B5KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihcbiAgICAgICAgICAgICAgICB7IG5hbWU6IHBrZy5uYW1lLCBlcnJvcjogZXJyIH0sXG4gICAgICAgICAgICAgICAgJ3Blcm1pc3Npb24gcHJvY2VzcyBmb3IgQHtuYW1lfSBoYXMgZmFpbGVkOiBAe2Vycm9yfSdcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiBwZXJtaXNzaW9ucztcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHsgd2ViIH0gPSBjb25maWc7XG4gICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgY29uc3Qgb3JkZXI6IGJvb2xlYW4gPSBjb25maWcud2ViID8gZ2V0T3JkZXIod2ViLnNvcnRfcGFja2FnZXMpIDogdHJ1ZTtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgIG5leHQoc29ydEJ5TmFtZShhd2FpdCBwcm9jZXNzUGFja2FnZXMocGFja2FnZXMpLCBvcmRlcikpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIG5leHQoRXJyb3JDb2RlLmdldEludGVybmFsRXJyb3IoKSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgKTtcblxuICAvLyBHZXQgcGFja2FnZSByZWFkbWVcbiAgcGtnUm91dGVyLmdldChcbiAgICBbXG4gICAgICAnLy0vdmVyZGFjY2lvL2RhdGEvcGFja2FnZS9yZWFkbWUvQDpzY29wZS86cGFja2FnZS86dmVyc2lvbj8nLFxuICAgICAgJy8tL3ZlcmRhY2Npby9kYXRhL3BhY2thZ2UvcmVhZG1lLzpwYWNrYWdlLzp2ZXJzaW9uPycsXG4gICAgXSxcbiAgICBjYW4oJ2FjY2VzcycpLFxuICAgIGZ1bmN0aW9uIChyZXE6ICRSZXF1ZXN0RXh0ZW5kLCByZXM6ICRSZXNwb25zZUV4dGVuZCwgbmV4dDogJE5leHRGdW5jdGlvblZlcik6IHZvaWQge1xuICAgICAgY29uc3Qgc2NvcGUgPSByZXEucGFyYW1zLnNjb3BlO1xuICAgICAgY29uc3QgcGFja2FnZU5hbWUgPSBzY29wZSA/IGFkZFNjb3BlKHNjb3BlLCByZXEucGFyYW1zLnBhY2thZ2UpIDogcmVxLnBhcmFtcy5wYWNrYWdlO1xuXG4gICAgICBzdG9yYWdlLmdldFBhY2thZ2Uoe1xuICAgICAgICBuYW1lOiBwYWNrYWdlTmFtZSxcbiAgICAgICAgdXBsaW5rc0xvb2s6IHRydWUsXG4gICAgICAgIHJlcSxcbiAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uIChlcnIsIGluZm8pOiB2b2lkIHtcbiAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV4dChlcnIpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJlcy5zZXQoSEVBREVSX1RZUEUuQ09OVEVOVF9UWVBFLCBIRUFERVJTLlRFWFRfUExBSU4pO1xuICAgICAgICAgIG5leHQocGFyc2VSZWFkbWUoaW5mby5uYW1lLCBpbmZvLnJlYWRtZSkpO1xuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfVxuICApO1xuXG4gIHBrZ1JvdXRlci5nZXQoXG4gICAgWycvLS92ZXJkYWNjaW8vZGF0YS9zaWRlYmFyL0A6c2NvcGUvOnBhY2thZ2UnLCAnLy0vdmVyZGFjY2lvL2RhdGEvc2lkZWJhci86cGFja2FnZSddLFxuICAgIGNhbignYWNjZXNzJyksXG4gICAgZnVuY3Rpb24gKHJlcTogJFJlcXVlc3RFeHRlbmQsIHJlczogJFJlc3BvbnNlRXh0ZW5kLCBuZXh0OiAkTmV4dEZ1bmN0aW9uVmVyKTogdm9pZCB7XG4gICAgICBjb25zdCBzY29wZSA9IHJlcS5wYXJhbXMuc2NvcGU7XG4gICAgICBjb25zdCBwYWNrYWdlTmFtZTogc3RyaW5nID0gc2NvcGUgPyBhZGRTY29wZShzY29wZSwgcmVxLnBhcmFtcy5wYWNrYWdlKSA6IHJlcS5wYXJhbXMucGFja2FnZTtcblxuICAgICAgc3RvcmFnZS5nZXRQYWNrYWdlKHtcbiAgICAgICAgbmFtZTogcGFja2FnZU5hbWUsXG4gICAgICAgIHVwbGlua3NMb29rOiB0cnVlLFxuICAgICAgICBrZWVwVXBMaW5rRGF0YTogdHJ1ZSxcbiAgICAgICAgcmVxLFxuICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24gKGVycjogRXJyb3IsIGluZm86ICRTaWRlYmFyUGFja2FnZSk6IHZvaWQge1xuICAgICAgICAgIGlmIChfLmlzTmlsKGVycikpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgdiB9ID0gcmVxLnF1ZXJ5O1xuICAgICAgICAgICAgbGV0IHNpZGVCYXJJbmZvOiBhbnkgPSBfLmNsb25lKGluZm8pO1xuICAgICAgICAgICAgc2lkZUJhckluZm8udmVyc2lvbnMgPSBjb252ZXJ0RGlzdFJlbW90ZVRvTG9jYWxUYXJiYWxsVXJscyhcbiAgICAgICAgICAgICAgaW5mbyxcbiAgICAgICAgICAgICAgeyBwcm90b2NvbDogcmVxLnByb3RvY29sLCBoZWFkZXJzOiByZXEuaGVhZGVycyBhcyBhbnksIGhvc3Q6IHJlcS5ob3N0bmFtZSB9LFxuICAgICAgICAgICAgICBjb25maWcudXJsX3ByZWZpeFxuICAgICAgICAgICAgKS52ZXJzaW9ucztcbiAgICAgICAgICAgIGlmIChpc1ZlcnNpb25WYWxpZChpbmZvLCB2KSkge1xuICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICAgIHNpZGVCYXJJbmZvLmxhdGVzdCA9IHNpZGVCYXJJbmZvLnZlcnNpb25zW3ZdO1xuICAgICAgICAgICAgICBzaWRlQmFySW5mby5sYXRlc3QuYXV0aG9yID0gZm9ybWF0QXV0aG9yKHNpZGVCYXJJbmZvLmxhdGVzdC5hdXRob3IpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgc2lkZUJhckluZm8ubGF0ZXN0ID0gc2lkZUJhckluZm8udmVyc2lvbnNbaW5mb1tESVNUX1RBR1NdLmxhdGVzdF07XG4gICAgICAgICAgICAgIGlmIChzaWRlQmFySW5mbz8ubGF0ZXN0KSB7XG4gICAgICAgICAgICAgICAgc2lkZUJhckluZm8ubGF0ZXN0LmF1dGhvciA9IGZvcm1hdEF1dGhvcihzaWRlQmFySW5mby5sYXRlc3QuYXV0aG9yKTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXMuc3RhdHVzKEhUVFBfU1RBVFVTLk5PVF9GT1VORCk7XG4gICAgICAgICAgICAgICAgcmVzLmVuZCgpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2lkZUJhckluZm8gPSBkZWxldGVQcm9wZXJ0aWVzKFsncmVhZG1lJywgJ19hdHRhY2htZW50cycsICdfcmV2JywgJ25hbWUnXSwgc2lkZUJhckluZm8pO1xuICAgICAgICAgICAgaWYgKGNvbmZpZy53ZWIpIHtcbiAgICAgICAgICAgICAgc2lkZUJhckluZm8gPSBhZGRHcmF2YXRhclN1cHBvcnQoc2lkZUJhckluZm8sIGNvbmZpZy53ZWIuZ3JhdmF0YXIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgc2lkZUJhckluZm8gPSBhZGRHcmF2YXRhclN1cHBvcnQoc2lkZUJhckluZm8pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbmV4dChzaWRlQmFySW5mbyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlcy5zdGF0dXMoSFRUUF9TVEFUVVMuTk9UX0ZPVU5EKTtcbiAgICAgICAgICAgIHJlcy5lbmQoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9XG4gICk7XG5cbiAgcmV0dXJuIHBrZ1JvdXRlcjtcbn1cblxuZXhwb3J0IGRlZmF1bHQgYWRkUGFja2FnZVdlYkFwaTtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQ0EsSUFBQUEsT0FBQSxHQUFBQyxzQkFBQSxDQUFBQyxPQUFBO0FBRUEsSUFBQUMsV0FBQSxHQUFBRCxPQUFBO0FBQ0EsSUFBQUUsUUFBQSxHQUFBRixPQUFBO0FBS0EsSUFBQUcsTUFBQSxHQUFBSCxPQUFBO0FBR0EsSUFBQUksVUFBQSxHQUFBSixPQUFBO0FBQ0EsSUFBQUssT0FBQSxHQUFBTCxPQUFBO0FBRUEsSUFBQU0sT0FBQSxHQUFBTixPQUFBO0FBUzRCLFNBQUFELHVCQUFBUSxDQUFBLFdBQUFBLENBQUEsSUFBQUEsQ0FBQSxDQUFBQyxVQUFBLEdBQUFELENBQUEsS0FBQUUsT0FBQSxFQUFBRixDQUFBO0FBQUEsU0FBQUcsUUFBQUgsQ0FBQSxFQUFBSSxDQUFBLFFBQUFDLENBQUEsR0FBQUMsTUFBQSxDQUFBQyxJQUFBLENBQUFQLENBQUEsT0FBQU0sTUFBQSxDQUFBRSxxQkFBQSxRQUFBQyxDQUFBLEdBQUFILE1BQUEsQ0FBQUUscUJBQUEsQ0FBQVIsQ0FBQSxHQUFBSSxDQUFBLEtBQUFLLENBQUEsR0FBQUEsQ0FBQSxDQUFBQyxNQUFBLFdBQUFOLENBQUEsV0FBQUUsTUFBQSxDQUFBSyx3QkFBQSxDQUFBWCxDQUFBLEVBQUFJLENBQUEsRUFBQVEsVUFBQSxPQUFBUCxDQUFBLENBQUFRLElBQUEsQ0FBQUMsS0FBQSxDQUFBVCxDQUFBLEVBQUFJLENBQUEsWUFBQUosQ0FBQTtBQUFBLFNBQUFVLGNBQUFm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