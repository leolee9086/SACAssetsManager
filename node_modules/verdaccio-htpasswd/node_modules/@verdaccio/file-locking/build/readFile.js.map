{"version":3,"file":"readFile.js","names":["_lockfile","require","_utils","lock","name","options","lockFileNext","read","readFile","parseJSON","contents","Promise","resolve","reject","parse","JSON","err","readFileNext","_options","content","parsed"],"sources":["../src/readFile.ts"],"sourcesContent":["import { lockFileNext } from './lockfile';\nimport { readFile } from './utils';\n\nexport type ReadFileOptions = {\n  parse?: boolean;\n  lock?: boolean;\n};\n\nasync function lock(name: string, options: ReadFileOptions): Promise<null | void> {\n  if (!options.lock) {\n    return null;\n  }\n\n  await lockFileNext(name);\n}\n\nasync function read(name: string): Promise<string> {\n  return readFile(name, 'utf8');\n}\n\nfunction parseJSON(contents: string, options): Promise<unknown> {\n  return new Promise((resolve, reject): void => {\n    if (!options.parse) {\n      return resolve(contents);\n    }\n    try {\n      contents = JSON.parse(contents);\n      return resolve(contents);\n    } catch (err: any) {\n      return reject(err);\n    }\n  });\n}\n\n/**\n *  Reads a local file, which involves\n *  optionally taking a lock\n *  reading the file contents\n *  optionally parsing JSON contents\n * @param {*} name\n * @param {*} options\n * @param {*} callback\n */\nexport async function readFileNext<T>(name: string, options: ReadFileOptions = {}): Promise<T> {\n  const _options = {\n    lock: options?.lock || false,\n    parse: options?.parse || false,\n  };\n  await lock(name, _options);\n  const content = await read(name);\n  const parsed = await parseJSON(content, options);\n  return parsed as T;\n}\n"],"mappings":";;;;;;AAAA,IAAAA,SAAA,GAAAC,OAAA;AACA,IAAAC,MAAA,GAAAD,OAAA;AAOA,eAAeE,IAAIA,CAACC,IAAY,EAAEC,OAAwB,EAAwB;EAChF,IAAI,CAACA,OAAO,CAACF,IAAI,EAAE;IACjB,OAAO,IAAI;EACb;EAEA,MAAM,IAAAG,sBAAY,EAACF,IAAI,CAAC;AAC1B;AAEA,eAAeG,IAAIA,CAACH,IAAY,EAAmB;EACjD,OAAO,IAAAI,eAAQ,EAACJ,IAAI,EAAE,MAAM,CAAC;AAC/B;AAEA,SAASK,SAASA,CAACC,QAAgB,EAAEL,OAAO,EAAoB;EAC9D,OAAO,IAAIM,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAW;IAC5C,IAAI,CAACR,OAAO,CAACS,KAAK,EAAE;MAClB,OAAOF,OAAO,CAACF,QAAQ,CAAC;IAC1B;IACA,IAAI;MACFA,QAAQ,GAAGK,IAAI,CAACD,KAAK,CAACJ,QAAQ,CAAC;MAC/B,OAAOE,OAAO,CAACF,QAAQ,CAAC;IAC1B,CAAC,CAAC,OAAOM,GAAQ,EAAE;MACjB,OAAOH,MAAM,CAACG,GAAG,CAAC;IACpB;EACF,CAAC,CAAC;AACJ;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,eAAeC,YAAYA,CAAIb,IAAY,EAAEC,OAAwB,GAAG,CAAC,CAAC,EAAc;EAC7F,MAAMa,QAAQ,GAAG;IACff,IAAI,EAAEE,OAAO,EAAEF,IAAI,IAAI,KAAK;IAC5BW,KAAK,EAAET,OAAO,EAAES,KAAK,IAAI;EAC3B,CAAC;EACD,MAAMX,IAAI,CAACC,IAAI,EAAEc,QAAQ,CAAC;EAC1B,MAAMC,OAAO,GAAG,MAAMZ,IAAI,CAACH,IAAI,CAAC;EAChC,MAAMgB,MAAM,GAAG,MAAMX,SAAS,CAACU,OAAO,EAAEd,OAAO,CAAC;EAChD,OAAOe,MAAM;AACf","ignoreList":[]}