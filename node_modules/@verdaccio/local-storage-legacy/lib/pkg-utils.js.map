{"version":3,"file":"pkg-utils.js","names":["_fs","_interopRequireDefault","require","_lodash","obj","__esModule","default","loadPrivatePackages","path","logger","list","emptyDatabase","secret","data","fs","readFileSync","_","isNil","db","JSON","parse","err","error","mesage","Error","isEmpty"],"sources":["../src/pkg-utils.ts"],"sourcesContent":["import fs from 'fs';\n\nimport _ from 'lodash';\nimport { LocalStorage, StorageList, Logger } from '@verdaccio/legacy-types';\n\nexport function loadPrivatePackages(path: string, logger: Logger): LocalStorage {\n  const list: StorageList = [];\n  const emptyDatabase = { list, secret: '' };\n  const data = fs.readFileSync(path, 'utf8');\n\n  if (_.isNil(data)) {\n    // readFileSync is platform specific, FreeBSD might return null\n    return emptyDatabase;\n  }\n\n  let db;\n  try {\n    db = JSON.parse(data);\n  } catch (err: any) {\n    logger.error(\n      {\n        err: err.mesage,\n        path,\n      }, // eslint-disable-next-line max-len\n      `Package database file corrupted (invalid JSON), please check the error @{err}.\\nFile Path: @{path}`\n    );\n    throw Error('Package database file corrupted (invalid JSON)');\n  }\n\n  if (_.isEmpty(db)) {\n    return emptyDatabase;\n  }\n\n  return db;\n}\n"],"mappings":";;;;;;AAAA,IAAAA,GAAA,GAAAC,sBAAA,CAAAC,OAAA;AAEA,IAAAC,OAAA,GAAAF,sBAAA,CAAAC,OAAA;AAAuB,SAAAD,uBAAAG,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;AAGhB,SAASG,mBAAmBA,CAACC,IAAY,EAAEC,MAAc,EAAgB;EAC9E,MAAMC,IAAiB,GAAG,EAAE;EAC5B,MAAMC,aAAa,GAAG;IAAED,IAAI;IAAEE,MAAM,EAAE;EAAG,CAAC;EAC1C,MAAMC,IAAI,GAAGC,WAAE,CAACC,YAAY,CAACP,IAAI,EAAE,MAAM,CAAC;EAE1C,IAAIQ,eAAC,CAACC,KAAK,CAACJ,IAAI,CAAC,EAAE;IACjB;IACA,OAAOF,aAAa;EACtB;EAEA,IAAIO,EAAE;EACN,IAAI;IACFA,EAAE,GAAGC,IAAI,CAACC,KAAK,CAACP,IAAI,CAAC;EACvB,CAAC,CAAC,OAAOQ,GAAQ,EAAE;IACjBZ,MAAM,CAACa,KAAK,CACV;MACED,GAAG,EAAEA,GAAG,CAACE,MAAM;MACff;IACF,CAAC;IAAE;IACF,oGACH,CAAC;IACD,MAAMgB,KAAK,CAAC,gDAAgD,CAAC;EAC/D;EAEA,IAAIR,eAAC,CAACS,OAAO,CAACP,EAAE,CAAC,EAAE;IACjB,OAAOP,aAAa;EACtB;EAEA,OAAOO,EAAE;AACX"}